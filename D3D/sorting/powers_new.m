function b = powers_new(a);

% Multiplicative constants (kappa) to get the power radiating in the i^th viewing chord
kappa=[1.976e8,2.060e8,2.146e8,2.319e8,2.277e8,2.773e8, ...
       2.845e8,2.877e8,2.780e8,2.692e8,2.519e8,2.509e8, ...
       1.004e8,0.935e8,0.893e8,0.790e8,0.711e8,0.683e8, ...
       0.861e8,0.834e8,0.812e8,0.860e8,0.941e8,0.991e8, ...
       1.605e8,1.588e8,1.592e8,1.561e8,1.496e8,0.700e8, ...
       0.698e8,0.699e8,0.719e8,0.774e8,0.865e8,0.692e8, ...
       0.683e8,0.698e8,0.739e8,1.742e8,1.771e8,1.898e8, ...
       1.935e8,1.994e8,2.035e8,2.033e8,2.030e8,0.848e8, ...
       4.632e8,4.370e8,4.230e8,3.792e8,3.565e8,3.166e8,2.836e8];

% Multiplicative constants (etendu, or K from Leonard 1995 formula 2) to get the 
% brightness for the i^th viewing chord
% [See bolo_geometric_values_d3d.xlsx or Tony Leonard's prad.pro routine]
etendu = [30206,29034,28066,27273,26635,40340,39855,39488, ...
       	  39235,39091,39055,39126,7972,8170,8498,7549, ...
          7129,6854,11162,11070,11081,11196,11419,11761, ...
       	  29321,28825,28449,28187,28033,7058,7140,7334, ...
          7657,8136,8819,7112,6654,6330,6123,29621, ...
       	  29485,29431,29458,29565,29756,30032,30397,6406]*1e4; % convert to [m^(-2)]

channel = struct('label', '', ...
                 'chanpwr', zeros(1,4096), ...
				 'brightness',zeros(1,4096), ...
                 'R', 0.0, ...
                 'Z', 0.0, ...
                 'angle', 0.0);
ch=repmat(channel,1,48);
b = struct('pwrmix', zeros(1,4096), ...
           'divl', zeros(1,4096), ...
           'divu', zeros(1,4096), ...
           'chan', ch);

for i=1:48;
  b.chan(i).chanpwr=kappa(i)*a.chan(i).pwr;
  b.chan(i).brightness = etendu(i)*a.chan(i).pwr;
  b.chan(i).R = a.chan(i).R;
  b.chan(i).Z = a.chan(i).Z;
  b.chan(i).angle = a.chan(i).angle;
end;

b.pwrmix = 0.0;
b.divl = 0.0;
b.divu = 0.0;

% Calculate power radiated from lower divertor region
for i = 25:31;
  b.divl = b.divl + b.chan(i).chanpwr;
end;

% Calculate power radiated from upper divertor region
for i = 22:24;
  b.divu = b.divu + b.chan(i).chanpwr;
end;

% Calculate total radiated power (based on Tony Leonard's IDL code)
for i = 1:21;
  b.pwrmix=b.pwrmix+b.chan(i).chanpwr;
end;
for i = 6:12;
  b.pwrmix = b.pwrmix - kappa(i)*b.divl/7.0/kappa(i+43);
end;
b.pwrmix = b.pwrmix + b.divu + b.divl;

return;
end
